<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Data Annotation Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4A49C5',
                    }
                }
            }
        }
    </script>
    <style>
        .rating-button { transition: all 0.2s ease; }
        .rating-button:hover { transform: translateY(-2px); }
        .rating-button.selected { transform: scale(1.05); }
        .task-card { transition: all 0.3s ease; }
        .task-card:hover { transform: translateY(-4px); box-shadow: 0 10px 25px rgba(93, 92, 222, 0.15); }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .tab-active { border-bottom: 2px solid #5D5CDE; color: #5D5CDE; }
    </style>
</head>
<body class="bg-white dark:bg-[#181818] text-gray-900 dark:text-gray-100 min-h-screen transition-colors">
    <!-- Login View -->
    <div id="loginView" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-900 rounded-xl shadow-2xl border border-gray-200 dark:border-gray-800 w-full max-w-md overflow-hidden fade-in">
            <div class="bg-gradient-to-r from-primary to-purple-600 p-8 text-white text-center">
                <div class="w-16 h-16 bg-white/20 rounded-xl flex items-center justify-center mx-auto mb-4">
                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                    </svg>
                </div>
                <h1 class="text-2xl font-bold mb-2">AI Data Annotation</h1>
                <p class="text-purple-100">Sign in to continue</p>
            </div>

            <div class="p-8">
                <form id="loginForm" class="space-y-6">
                    <div>
                        <label for="username" class="block text-base font-semibold text-gray-900 dark:text-white mb-2">Username</label>
                        <input type="text" id="username" class="w-full px-4 py-3 text-base bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Enter your username" required>
                    </div>

                    <div>
                        <label for="password" class="block text-base font-semibold text-gray-900 dark:text-white mb-2">Password</label>
                        <input type="password" id="password" class="w-full px-4 py-3 text-base bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Enter your password" required>
                    </div>

                    <div>
                        <label for="role" class="block text-base font-semibold text-gray-900 dark:text-white mb-2">Role</label>
                        <select id="role" class="w-full px-4 py-3 text-base bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="annotator">Data Annotator</option>
                            <option value="reviewer">Reviewer</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>

                    <button type="submit" class="w-full bg-primary hover:bg-primary-dark text-white font-semibold py-3 px-6 rounded-lg transition-colors text-base">
                        Sign In
                    </button>
                </form>

                <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-800">
                    <p class="text-sm text-gray-600 dark:text-gray-400 text-center mb-3">Demo Credentials:</p>
                    <div class="space-y-2 text-sm text-gray-700 dark:text-gray-300">
                        <p><strong>Annotator:</strong> user: annotator / pass: annotator123</p>
                        <p><strong>Reviewer:</strong> user: reviewer / pass: reviewer123</p>
                        <p><strong>Admin:</strong> user: admin / pass: admin123</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- App Container (Hidden until logged in) -->
    <div id="appContainer" class="hidden">
        <!-- Header -->
        <header class="bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 sticky top-0 z-10">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-900 dark:text-white">AI Data Annotation</h1>
                            <p class="text-sm text-gray-600 dark:text-gray-400" id="userInfo"></p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-right hidden sm:block" id="statsDisplay">
                            <p class="text-sm text-gray-600 dark:text-gray-400">Completed</p>
                            <p class="text-lg font-semibold text-primary" id="completedCount">0</p>
                        </div>
                        <button id="logoutButton" class="px-4 py-2 text-base bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-semibold rounded-lg transition-colors">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Annotator Dashboard -->
        <div id="annotatorDashboard" class="hidden">
            <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <!-- Task List View -->
                <div id="taskListView">
                    <div class="mb-6">
                        <div class="border-b border-gray-200 dark:border-gray-800">
                            <nav class="flex space-x-8">
                                <button class="tab-button py-4 px-2 text-base font-semibold transition-colors tab-active" data-tab="available">
                                    Available Tasks
                                </button>
                                <button class="tab-button py-4 px-2 text-base font-semibold transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white" data-tab="feedback">
                                    My Feedback
                                </button>
                            </nav>
                        </div>
                    </div>

                    <!-- Available Tasks Tab -->
                    <div id="availableTasksTab" class="tab-content">
                        <div class="mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Available Tasks</h2>
                                <p class="text-gray-600 dark:text-gray-400 mt-1">Select a task to begin annotation</p>
                            </div>
                            <div class="flex items-center space-x-3">
                                <select id="filterStatus" class="px-4 py-2 text-base bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="all">All Tasks</option>
                                    <option value="pending">Pending</option>
                                    <option value="submitted">Submitted</option>
                                </select>
                            </div>
                        </div>

                        <!-- Task Cards -->
                        <div id="taskCards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Task cards will be inserted here -->
                        </div>
                    </div>

                    <!-- Feedback Tab -->
                    <div id="feedbackTab" class="tab-content hidden">
                        <div class="mb-6">
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Reviewer Feedback</h2>
                            <p class="text-gray-600 dark:text-gray-400 mt-1">View feedback on your submissions</p>
                        </div>
                        <div id="feedbackList" class="space-y-4">
                            <!-- Feedback items will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- Annotation View -->
                <div id="annotationView" class="hidden fade-in">
                    <div class="mb-6">
                        <button id="backButton" class="flex items-center text-primary hover:text-primary-dark transition-colors">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                            Back to Tasks
                        </button>
                    </div>

                    <div class="bg-white dark:bg-gray-900 rounded-xl shadow-lg border border-gray-200 dark:border-gray-800 overflow-hidden">
                        <!-- Task Header -->
                        <div class="bg-gradient-to-r from-primary to-purple-600 p-6 text-white">
                            <h2 id="taskTitle" class="text-2xl font-bold mb-2"></h2>
                            <p id="taskDescription" class="text-purple-100"></p>
                        </div>

                        <!-- Task Content -->
                        <div class="p-6 space-y-6">
                            <!-- Prompt Section -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-3 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                                    </svg>
                                    User Prompt
                                </h3>
                                <div id="promptContent" class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700 whitespace-pre-wrap">
                                </div>
                            </div>

                            <!-- AI Response Section -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-3 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                                    </svg>
                                    AI Response
                                </h3>
                                <div id="responseContent" class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800 whitespace-pre-wrap">
                                </div>
                            </div>

                            <!-- Annotation Form -->
                            <div class="border-t border-gray-200 dark:border-gray-800 pt-6">
                                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6">Rate This Response</h3>

                                <form id="annotationForm" class="space-y-8">
                                    <!-- Accuracy -->
                                    <div class="rating-section">
                                        <label class="block text-base font-semibold text-gray-900 dark:text-white mb-3">
                                            Accuracy
                                            <span class="text-sm font-normal text-gray-600 dark:text-gray-400 ml-2">How factually correct is the response?</span>
                                        </label>
                                        <div class="flex flex-wrap gap-2">
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="accuracy" data-value="1">1 - Very Inaccurate</button>
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="accuracy" data-value="2">2 - Inaccurate</button>
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="accuracy" data-value="3">3 - Neutral</button>
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="accuracy" data-value="4">4 - Accurate</button>
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="accuracy" data-value="5">5 - Very Accurate</button>
                                        </div>
                                    </div>

                                    <!-- Relevance -->
                                    <div class="rating-section">
                                        <label class="block text-base font-semibold text-gray-900 dark:text-white mb-3">
                                            Relevance
                                            <span class="text-sm font-normal text-gray-600 dark:text-gray-400 ml-2">How well does it address the prompt?</span>
                                        </label>
                                        <div class="flex flex-wrap gap-2">
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="relevance" data-value="1">1 - Off-topic</button>
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="relevance" data-value="2">2 - Somewhat Relevant</button>
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="relevance" data-value="3">3 - Neutral</button>
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="relevance" data-value="4">4 - Relevant</button>
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="relevance" data-value="5">5 - Highly Relevant</button>
                                        </div>
                                    </div>

                                    <!-- Safety -->
                                    <div class="rating-section">
                                        <label class="block text-base font-semibold text-gray-900 dark:text-white mb-3">
                                            Safety
                                            <span class="text-sm font-normal text-gray-600 dark:text-gray-400 ml-2">Is the content safe and appropriate?</span>
                                        </label>
                                        <div class="flex flex-wrap gap-2">
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="safety" data-value="1">1 - Unsafe</button>
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="safety" data-value="2">2 - Potentially Unsafe</button>
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="safety" data-value="3">3 - Neutral</button>
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="safety" data-value="4">4 - Safe</button>
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="safety" data-value="5">5 - Very Safe</button>
                                        </div>
                                    </div>

                                    <!-- Helpfulness -->
                                    <div class="rating-section">
                                        <label class="block text-base font-semibold text-gray-900 dark:text-white mb-3">
                                            Helpfulness
                                            <span class="text-sm font-normal text-gray-600 dark:text-gray-400 ml-2">How useful is this response?</span>
                                        </label>
                                        <div class="flex flex-wrap gap-2">
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="helpfulness" data-value="1">1 - Not Helpful</button>
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="helpfulness" data-value="2">2 - Slightly Helpful</button>
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="helpfulness" data-value="3">3 - Neutral</button>
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="helpfulness" data-value="4">4 - Helpful</button>
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="helpfulness" data-value="5">5 - Very Helpful</button>
                                        </div>
                                    </div>

                                    <!-- Completeness -->
                                    <div class="rating-section">
                                        <label class="block text-base font-semibold text-gray-900 dark:text-white mb-3">
                                            Completeness
                                            <span class="text-sm font-normal text-gray-600 dark:text-gray-400 ml-2">Does it fully answer the question?</span>
                                        </label>
                                        <div class="flex flex-wrap gap-2">
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="completeness" data-value="1">1 - Incomplete</button>
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="completeness" data-value="2">2 - Mostly Incomplete</button>
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="completeness" data-value="3">3 - Neutral</button>
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="completeness" data-value="4">4 - Mostly Complete</button>
                                            <button type="button" class="rating-button px-6 py-3 text-base bg-gray-100 dark:bg-gray-800 hover:bg-primary hover:text-white border border-gray-300 dark:border-gray-700 rounded-lg transition-colors" data-rating="completeness" data-value="5">5 - Complete</button>
                                        </div>
                                    </div>

                                    <!-- Additional Notes -->
                                    <div>
                                        <label for="notes" class="block text-base font-semibold text-gray-900 dark:text-white mb-3">
                                            Additional Notes (Optional)
                                        </label>
                                        <textarea id="notes" rows="4" class="w-full px-4 py-3 text-base bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent resize-none" placeholder="Add any additional comments or observations..."></textarea>
                                    </div>

                                    <!-- Submit Button -->
                                    <div class="flex flex-col sm:flex-row gap-3 pt-4">
                                        <button type="submit" id="submitButton" class="flex-1 bg-primary hover:bg-primary-dark text-white font-semibold py-4 px-6 rounded-lg transition-colors text-base">
                                            Submit Annotation
                                        </button>
                                        <button type="button" id="skipButton" class="sm:w-auto px-6 py-4 text-base bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-semibold rounded-lg transition-colors">
                                            Skip Task
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Reviewer Dashboard -->
        <div id="reviewerDashboard" class="hidden">
            <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <div class="mb-6">
                    <div class="border-b border-gray-200 dark:border-gray-800">
                        <nav class="flex space-x-8">
                            <button class="reviewer-tab py-4 px-2 text-base font-semibold transition-colors tab-active" data-tab="submissions">
                                Review Submissions
                            </button>
                            <button class="reviewer-tab py-4 px-2 text-base font-semibold transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white" data-tab="create">
                                Create Task
                            </button>
                            <button class="reviewer-tab py-4 px-2 text-base font-semibold transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white" data-tab="manage">
                                Manage Tasks
                            </button>
                        </nav>
                    </div>
                </div>

                <!-- Review Submissions Tab -->
                <div id="submissionsTab" class="reviewer-tab-content">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Annotator Submissions</h2>
                        <p class="text-gray-600 dark:text-gray-400 mt-1">Review and provide feedback on annotations</p>
                    </div>
                    <div id="submissionsList" class="space-y-4">
                        <!-- Submissions will be inserted here -->
                    </div>
                </div>

                <!-- Create Task Tab -->
                <div id="createTaskTab" class="reviewer-tab-content hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Create New Task</h2>
                        <p class="text-gray-600 dark:text-gray-400 mt-1">Add a new annotation task for data annotators</p>
                    </div>

                    <div class="bg-white dark:bg-gray-900 rounded-xl shadow-lg border border-gray-200 dark:border-gray-800 p-8">
                        <form id="createTaskForm" class="space-y-6">
                            <div>
                                <label for="taskTitleInput" class="block text-base font-semibold text-gray-900 dark:text-white mb-2">Task Title</label>
                                <input type="text" id="taskTitleInput" class="w-full px-4 py-3 text-base bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Enter task title" required>
                            </div>

                            <div>
                                <label for="taskDescriptionInput" class="block text-base font-semibold text-gray-900 dark:text-white mb-2">Description</label>
                                <textarea id="taskDescriptionInput" rows="2" class="w-full px-4 py-3 text-base bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent resize-none" placeholder="Describe what annotators should evaluate" required></textarea>
                            </div>

                            <div>
                                <label for="taskPromptInput" class="block text-base font-semibold text-gray-900 dark:text-white mb-2">User Prompt</label>
                                <textarea id="taskPromptInput" rows="3" class="w-full px-4 py-3 text-base bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent resize-none" placeholder="Enter the user's prompt/question" required></textarea>
                            </div>

                            <div>
                                <label for="taskResponseInput" class="block text-base font-semibold text-gray-900 dark:text-white mb-2">AI Response</label>
                                <textarea id="taskResponseInput" rows="6" class="w-full px-4 py-3 text-base bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent resize-none" placeholder="Enter the AI's response to be evaluated" required></textarea>
                            </div>

                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label for="taskCategoryInput" class="block text-base font-semibold text-gray-900 dark:text-white mb-2">Category</label>
                                    <input type="text" id="taskCategoryInput" class="w-full px-4 py-3 text-base bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="e.g., Customer Support, Technical" required>
                                </div>

                                <div>
                                    <label for="taskPriorityInput" class="block text-base font-semibold text-gray-900 dark:text-white mb-2">Priority</label>
                                    <select id="taskPriorityInput" class="w-full px-4 py-3 text-base bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                        <option value="low">Low</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="high">High</option>
                                    </select>
                                </div>
                            </div>

                            <button type="submit" class="w-full bg-primary hover:bg-primary-dark text-white font-semibold py-4 px-6 rounded-lg transition-colors text-base">
                                Create Task
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Manage Tasks Tab -->
                <div id="manageTasksTab" class="reviewer-tab-content hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Manage Tasks</h2>
                        <p class="text-gray-600 dark:text-gray-400 mt-1">View and manage all annotation tasks</p>
                    </div>
                    <div id="manageTasksList" class="space-y-4">
                        <!-- Task management list will be inserted here -->
                    </div>
                </div>
            </main>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="hidden">
            <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <div class="mb-6">
                    <div class="border-b border-gray-200 dark:border-gray-800">
                        <nav class="flex space-x-8">
                            <button class="admin-tab py-4 px-2 text-base font-semibold transition-colors tab-active" data-tab="add-user">
                                Add User
                            </button>
                            <button class="admin-tab py-4 px-2 text-base font-semibold transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white" data-tab="manage-users">
                                Manage Users
                            </button>
                            <button class="admin-tab py-4 px-2 text-base font-semibold transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white" data-tab="change-password">
                                Change Password
                            </button>
                            <button class="admin-tab py-4 px-2 text-base font-semibold transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white" data-tab="overview">
                                Overview
                            </button>
                        </nav>
                    </div>
                </div>

                <!-- Add User Tab -->
                <div id="addUserTab" class="admin-tab-content">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Add New User</h2>
                        <p class="text-gray-600 dark:text-gray-400 mt-1">Manually create a new user account</p>
                    </div>

                    <div class="bg-white dark:bg-gray-900 rounded-xl shadow-lg border border-gray-200 dark:border-gray-800 p-8 max-w-2xl">
                        <form id="addUserForm" class="space-y-6">
                            <div>
                                <label for="newUserFullName" class="block text-base font-semibold text-gray-900 dark:text-white mb-2">Full Name</label>
                                <input type="text" id="newUserFullName" class="w-full px-4 py-3 text-base bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Enter full name" required>
                            </div>

                            <div>
                                <label for="newUserEmail" class="block text-base font-semibold text-gray-900 dark:text-white mb-2">Email Address</label>
                                <input type="email" id="newUserEmail" class="w-full px-4 py-3 text-base bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Enter email address" required>
                            </div>

                            <div>
                                <label for="newUserUsername" class="block text-base font-semibold text-gray-900 dark:text-white mb-2">Username</label>
                                <input type="text" id="newUserUsername" class="w-full px-4 py-3 text-base bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Choose a username" required>
                            </div>

                            <div>
                                <label for="newUserPassword" class="block text-base font-semibold text-gray-900 dark:text-white mb-2">Password</label>
                                <input type="password" id="newUserPassword" class="w-full px-4 py-3 text-base bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Set a password" required minlength="6">
                                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">At least 6 characters</p>
                            </div>

                            <div>
                                <label for="newUserRole" class="block text-base font-semibold text-gray-900 dark:text-white mb-2">Role</label>
                                <select id="newUserRole" class="w-full px-4 py-3 text-base bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="annotator">Data Annotator</option>
                                    <option value="reviewer">Reviewer</option>
                                </select>
                            </div>

                            <button type="submit" class="w-full bg-primary hover:bg-primary-dark text-white font-semibold py-4 px-6 rounded-lg transition-colors text-base">
                                Add User
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Manage Users Tab -->
                <div id="manageUsersTab" class="admin-tab-content hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Manage Users</h2>
                        <p class="text-gray-600 dark:text-gray-400 mt-1">View and manage all users</p>
                    </div>
                    <div id="usersList" class="space-y-4">
                        <!-- Users list will be inserted here -->
                    </div>
                </div>

                <!-- Change Password Tab -->
                <div id="changePasswordTab" class="admin-tab-content hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Change Admin Password</h2>
                        <p class="text-gray-600 dark:text-gray-400 mt-1">Update your admin account password</p>
                    </div>

                    <div class="bg-white dark:bg-gray-900 rounded-xl shadow-lg border border-gray-200 dark:border-gray-800 p-8 max-w-2xl">
                        <form id="changePasswordForm" class="space-y-6">
                            <div>
                                <label for="currentPassword" class="block text-base font-semibold text-gray-900 dark:text-white mb-2">Current Password</label>
                                <input type="password" id="currentPassword" class="w-full px-4 py-3 text-base bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Enter current password" required>
                            </div>

                            <div>
                                <label for="newPassword" class="block text-base font-semibold text-gray-900 dark:text-white mb-2">New Password</label>
                                <input type="password" id="newPassword" class="w-full px-4 py-3 text-base bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Enter new password" required minlength="6">
                                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">At least 6 characters</p>
                            </div>

                            <div>
                                <label for="confirmPassword" class="block text-base font-semibold text-gray-900 dark:text-white mb-2">Confirm New Password</label>
                                <input type="password" id="confirmPassword" class="w-full px-4 py-3 text-base bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Confirm new password" required minlength="6">
                            </div>

                            <button type="submit" class="w-full bg-primary hover:bg-primary-dark text-white font-semibold py-4 px-6 rounded-lg transition-colors text-base">
                                Update Password
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Overview Tab -->
                <div id="overviewTab" class="admin-tab-content hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Platform Overview</h2>
                        <p class="text-gray-600 dark:text-gray-400 mt-1">Key statistics and metrics</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white dark:bg-gray-900 rounded-xl shadow-md border border-gray-200 dark:border-gray-800 p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">Total Users</p>
                                    <p class="text-3xl font-bold text-primary" id="totalUsersCount">0</p>
                                </div>
                                <div class="w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-900 rounded-xl shadow-md border border-gray-200 dark:border-gray-800 p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">Total Tasks</p>
                                    <p class="text-3xl font-bold text-blue-600" id="totalTasksCount">0</p>
                                </div>
                                <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-900 rounded-xl shadow-md border border-gray-200 dark:border-gray-800 p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">Annotations</p>
                                    <p class="text-3xl font-bold text-green-600" id="totalAnnotationsCount">0</p>
                                </div>
                                <div class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-2xl max-w-md w-full mx-4 fade-in">
            <div class="text-center">
                <div class="w-16 h-16 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2" id="successTitle">Success!</h3>
                <p class="text-gray-600 dark:text-gray-400 mb-6" id="successMessage">Operation completed successfully.</p>
                <button id="closeModal" class="w-full bg-primary hover:bg-primary-dark text-white font-semibold py-3 px-6 rounded-lg transition-colors text-base">
                    Continue
                </button>
            </div>
        </div>
    </div>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) document.documentElement.classList.add('dark');
            else document.documentElement.classList.remove('dark');
        });

        // ===== PERSISTENCE HELPERS (localStorage) =====
        const LS_KEYS = {
            users: 'aidp_users',
            tasks: 'aidp_tasks',
            annotations: 'aidp_annotations',
            currentUser: 'aidp_current_user'
        };

        function lsGet(key, fallback) {
            try {
                const raw = localStorage.getItem(key);
                return raw ? JSON.parse(raw) : fallback;
            } catch {
                return fallback;
            }
        }
        function lsSet(key, value) {
            try {
                localStorage.setItem(key, JSON.stringify(value));
            } catch {
                // Quota or private mode: ignore
            }
        }

        // ===== DATA STORAGE & STATE MANAGEMENT =====

        // Seed defaults if none in localStorage
        const defaultTasks = [
            {
                id: Date.now() + 1,
                title: "Customer Support Query - Refund Policy",
                description: "Evaluate AI response to customer inquiry about refund policy",
                prompt: "What is your refund policy for online purchases?",
                response: "Our refund policy allows returns within 30 days of purchase for most items. To be eligible for a refund, items must be unused and in their original packaging. We process refunds within 5-7 business days after receiving the returned item. Some exclusions apply to perishable goods, custom-made items, and digital downloads. For defective products, we offer free return shipping and a full refund or replacement.",
                status: "pending",
                category: "Customer Support",
                priority: "high",
                createdBy: "reviewer",
                createdAt: new Date().toISOString()
            },
            {
                id: Date.now() + 2,
                title: "Technical Question - Python Programming",
                description: "Review AI explanation of Python list comprehensions",
                prompt: "Can you explain how Python list comprehensions work with an example?",
                response: "List comprehensions provide a concise way to create lists in Python. The basic syntax is: [expression for item in iterable if condition]. For example: squares = [x**2 for x in range(10)] creates a list of squares from 0 to 81. You can also add conditions: even_squares = [x**2 for x in range(10) if x % 2 == 0] creates squares of only even numbers. List comprehensions are faster and more Pythonic than traditional for loops for creating lists.",
                status: "pending",
                category: "Technical",
                priority: "medium",
                createdBy: "reviewer",
                createdAt: new Date().toISOString()
            }
        ];
        const defaultUsers = [
            { username: 'annotator', password: 'annotator123', role: 'annotator', fullName: 'Demo Annotator', email: 'annotator@demo.com', status: 'approved', approvedAt: new Date().toISOString() },
            { username: 'reviewer', password: 'reviewer123', role: 'reviewer', fullName: 'Demo Reviewer', email: 'reviewer@demo.com', status: 'approved', approvedAt: new Date().toISOString() },
            { username: 'admin', password: 'admin123', role: 'admin', fullName: 'System Admin', email: 'admin@demo.com', status: 'approved', approvedAt: new Date().toISOString() }
        ];

        const memoryStorage = {
            tasks: lsGet(LS_KEYS.tasks, defaultTasks),
            annotations: lsGet(LS_KEYS.annotations, []),
            users: lsGet(LS_KEYS.users, defaultUsers),
            currentUser: lsGet(LS_KEYS.currentUser, null)
        };

        // Keep localStorage in sync whenever we mutate
        function persistTasks() { lsSet(LS_KEYS.tasks, memoryStorage.tasks); }
        function persistAnnotations() { lsSet(LS_KEYS.annotations, memoryStorage.annotations); }
        function persistUsers() { lsSet(LS_KEYS.users, memoryStorage.users); }
        function persistCurrentUser() { lsSet(LS_KEYS.currentUser, memoryStorage.currentUser); }

        class DataStore {
            getTasks() { return memoryStorage.tasks; }
            saveTasks(tasks) { memoryStorage.tasks = tasks; persistTasks(); }
            addTask(task) { memoryStorage.tasks.push(task); persistTasks(); }
            updateTask(taskId, updates) {
                const i = memoryStorage.tasks.findIndex(t => t.id === taskId);
                if (i !== -1) { memoryStorage.tasks[i] = { ...memoryStorage.tasks[i], ...updates }; persistTasks(); }
            }
            deleteTask(taskId) {
                memoryStorage.tasks = memoryStorage.tasks.filter(t => t.id !== taskId);
                persistTasks();
            }

            getAnnotations() { return memoryStorage.annotations; }
            saveAnnotations(annotations) { memoryStorage.annotations = annotations; persistAnnotations(); }
            addAnnotation(annotation) { memoryStorage.annotations.push(annotation); persistAnnotations(); }
            updateAnnotation(annotationId, updates) {
                const i = memoryStorage.annotations.findIndex(a => a.id === annotationId);
                if (i !== -1) { memoryStorage.annotations[i] = { ...memoryStorage.annotations[i], ...updates }; persistAnnotations(); }
            }

            getUsers() { return memoryStorage.users; }
            saveUsers(users) { memoryStorage.users = users; persistUsers(); }
            addUser(user) { memoryStorage.users.push(user); persistUsers(); }
            updateUser(username, updates) {
                const i = memoryStorage.users.findIndex(u => u.username === username);
                if (i !== -1) { memoryStorage.users[i] = { ...memoryStorage.users[i], ...updates }; persistUsers(); }
            }
            deleteUser(username) {
                memoryStorage.users = memoryStorage.users.filter(u => u.username !== username);
                persistUsers();
            }

            authenticate(username, password, role) {
                return memoryStorage.users.find(u => u.username === username && u.password === password && u.role === role && u.status === 'approved');
            }

            isUsernameTaken(username) { return memoryStorage.users.some(u => u.username === username); }

            getCurrentUser() { return memoryStorage.currentUser; }
            setCurrentUser(user) { memoryStorage.currentUser = user; persistCurrentUser(); }
            clearCurrentUser() { memoryStorage.currentUser = null; persistCurrentUser(); }
        }

        const dataStore = new DataStore();
        let currentUser = null;
        let currentTask = null;
        const ratings = { accuracy: null, relevance: null, safety: null, helpfulness: null, completeness: null };

        // ===== AUTHENTICATION =====
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;

            const user = dataStore.authenticate(username, password, role);
            if (user) {
                currentUser = { ...user }; // shallow copy to avoid accidental mutation without persisting
                dataStore.setCurrentUser(currentUser);
                showApp();
            } else {
                showCustomAlert('Invalid credentials or account not approved. Please check your username, password, and role.');
            }
        });

        document.getElementById('logoutButton').addEventListener('click', () => {
            currentUser = null;
            dataStore.clearCurrentUser();
            document.getElementById('loginView').classList.remove('hidden');
            document.getElementById('appContainer').classList.add('hidden');
            document.getElementById('annotatorDashboard').classList.add('hidden');
            document.getElementById('reviewerDashboard').classList.add('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
        });

        function showApp() {
            document.getElementById('loginView').classList.add('hidden');
            document.getElementById('appContainer').classList.remove('hidden');
            document.getElementById('userInfo').textContent = `${currentUser.fullName || currentUser.username} (${currentUser.role})`;

            if (currentUser.role === 'annotator') {
                document.getElementById('annotatorDashboard').classList.remove('hidden');
                document.getElementById('reviewerDashboard').classList.add('hidden');
                document.getElementById('adminDashboard').classList.add('hidden');
                renderAnnotatorDashboard();
            } else if (currentUser.role === 'reviewer') {
                document.getElementById('annotatorDashboard').classList.add('hidden');
                document.getElementById('reviewerDashboard').classList.remove('hidden');
                document.getElementById('adminDashboard').classList.add('hidden');
                renderReviewerDashboard();
            } else if (currentUser.role === 'admin') {
                document.getElementById('annotatorDashboard').classList.add('hidden');
                document.getElementById('reviewerDashboard').classList.add('hidden');
                document.getElementById('adminDashboard').classList.remove('hidden');
                renderAdminDashboard();
            }
        }

        // Restore session if present
        const savedUser = dataStore.getCurrentUser();
        if (savedUser) {
            currentUser = savedUser;
            showApp();
        }

        // ===== ADMIN DASHBOARD =====
        function renderAdminDashboard() {
            renderUsersList();
            renderAdminOverview();
        }

        // Add User Form
        document.getElementById('addUserForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const fullName = document.getElementById('newUserFullName').value.trim();
            const email = document.getElementById('newUserEmail').value.trim();
            const username = document.getElementById('newUserUsername').value.trim();
            const password = document.getElementById('newUserPassword').value;
            const role = document.getElementById('newUserRole').value;

            if (dataStore.isUsernameTaken(username)) {
                showCustomAlert('Username already exists. Please choose a different username.');
                return;
            }

            const newUser = {
                fullName, email, username, password, role,
                status: 'approved',
                approvedAt: new Date().toISOString(),
                approvedBy: currentUser.username
            };

            dataStore.addUser(newUser);
            document.getElementById('addUserForm').reset();

            showSuccessModal('User Added!', `${fullName} has been successfully added as a ${role}.`);
            renderUsersList();
            renderAdminOverview();
        });

        // Change Password Form
        document.getElementById('changePasswordForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (currentPassword !== currentUser.password) {
                showCustomAlert('Current password is incorrect.');
                return;
            }
            if (newPassword !== confirmPassword) {
                showCustomAlert('New passwords do not match.');
                return;
            }
            if (newPassword.length < 6) {
                showCustomAlert('Password must be at least 6 characters long.');
                return;
            }

            // Update password in users store (persistent)
            dataStore.updateUser(currentUser.username, { password: newPassword });

            // Update current session and persist
            currentUser.password = newPassword;
            dataStore.setCurrentUser(currentUser);

            document.getElementById('changePasswordForm').reset();
            showSuccessModal('Password Changed!', 'Your admin password has been successfully updated.');
        });

        function renderUsersList() {
            const usersList = document.getElementById('usersList');
            const users = dataStore.getUsers().filter(u => u.username !== 'admin');

            if (users.length === 0) {
                usersList.innerHTML = `
                    <div class="text-center py-12">
                        <svg class="w-16 h-16 mx-auto text-gray-400 dark:text-gray-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                        <p class="text-gray-600 dark:text-gray-400 text-lg">No users yet</p>
                    </div>
                `;
                return;
            }

            usersList.innerHTML = users.map(user => {
                const roleColors = {
                    annotator: 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400',
                    reviewer: 'bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400'
                };

                const annotations = dataStore.getAnnotations();
                const userAnnotations = annotations.filter(a => a.annotator === user.username);

                return `
                    <div class="bg-white dark:bg-gray-900 rounded-xl shadow-md border border-gray-200 dark:border-gray-800 p-6">
                        <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-3">
                                    <h3 class="text-lg font-bold text-gray-900 dark:text-white">${user.fullName || user.username}</h3>
                                    <span class="text-xs font-semibold px-2.5 py-1 rounded-full ${roleColors[user.role]}">${user.role.toUpperCase()}</span>
                                </div>
                                <div class="space-y-1 text-sm text-gray-600 dark:text-gray-400">
                                    <p><strong>Email:</strong> ${user.email || 'N/A'}</p>
                                    <p><strong>Username:</strong> ${user.username}</p>
                                    <p><strong>Added:</strong> ${user.approvedAt ? new Date(user.approvedAt).toLocaleDateString() : 'N/A'}</p>
                                    ${user.role === 'annotator' ? `<p><strong>Annotations:</strong> ${userAnnotations.length}</p>` : ''}
                                </div>
                            </div>
                            <div>
                                <button class="delete-user-btn px-4 py-2 text-base bg-red-100 dark:bg-red-900/30 hover:bg-red-200 dark:hover:bg-red-900/50 text-red-800 dark:text-red-400 font-semibold rounded-lg transition-colors" data-username="${user.username}">
                                    Remove User
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            document.querySelectorAll('.delete-user-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const username = btn.dataset.username;
                    showConfirmDialog('Are you sure you want to remove this user? This action cannot be undone.', () => {
                        dataStore.deleteUser(username);
                        showSuccessModal('User Removed', 'The user has been removed from the system.');
                        renderUsersList();
                        renderAdminOverview();
                    });
                });
            });
        }

        function renderAdminOverview() {
            const users = dataStore.getUsers();
            const tasks = dataStore.getTasks();
            const annotations = dataStore.getAnnotations();

            document.getElementById('totalUsersCount').textContent = users.length;
            document.getElementById('totalTasksCount').textContent = tasks.length;
            document.getElementById('totalAnnotationsCount').textContent = annotations.length;
        }

        // Admin tabs
        document.querySelectorAll('.admin-tab').forEach(btn => {
            btn.addEventListener('click', () => {
                const tab = btn.dataset.tab;
                document.querySelectorAll('.admin-tab').forEach(b => {
                    b.classList.remove('tab-active');
                    b.classList.add('text-gray-600', 'dark:text-gray-400');
                });
                btn.classList.add('tab-active');
                btn.classList.remove('text-gray-600', 'dark:text-gray-400');

                document.querySelectorAll('.admin-tab-content').forEach(content => {
                    content.classList.add('hidden');
                });

                if (tab === 'add-user') {
                    document.getElementById('addUserTab').classList.remove('hidden');
                } else if (tab === 'manage-users') {
                    document.getElementById('manageUsersTab').classList.remove('hidden');
                } else if (tab === 'change-password') {
                    document.getElementById('changePasswordTab').classList.remove('hidden');
                } else if (tab === 'overview') {
                    document.getElementById('overviewTab').classList.remove('hidden');
                }
            });
        });

        // ===== ANNOTATOR DASHBOARD =====
        function renderAnnotatorDashboard() {
            renderTaskCards();
            renderFeedbackList();
            updateCompletedCount();
        }

        function renderTaskCards() {
            const taskCardsContainer = document.getElementById('taskCards');
            const filter = document.getElementById('filterStatus').value;
            const tasks = dataStore.getTasks();
            const annotations = dataStore.getAnnotations();

            const userAnnotations = annotations.filter(a => a.annotator === (currentUser?.username));
            const annotatedTaskIds = userAnnotations.map(a => a.id && a.taskId || a.taskId);

            let filteredTasks = tasks;
            if (filter === 'pending') {
                filteredTasks = tasks.filter(t => !annotatedTaskIds.includes(t.id));
            } else if (filter === 'submitted') {
                filteredTasks = tasks.filter(t => annotatedTaskIds.includes(t.id));
            }

            if (filteredTasks.length === 0) {
                taskCardsContainer.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <svg class="w-16 h-16 mx-auto text-gray-400 dark:text-gray-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <p class="text-gray-600 dark:text-gray-400 text-lg">No tasks available</p>
                    </div>
                `;
                return;
            }

            taskCardsContainer.innerHTML = filteredTasks.map(task => {
                const priorityColors = {
                    high: 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400',
                    medium: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400',
                    low: 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400'
                };

                const isSubmitted = annotatedTaskIds.includes(task.id);
                const statusColor = isSubmitted ? 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400' : 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400';
                const statusText = isSubmitted ? 'SUBMITTED' : 'PENDING';

                return `
                    <div class="task-card bg-white dark:bg-gray-900 rounded-xl shadow-md border border-gray-200 dark:border-gray-800 overflow-hidden ${!isSubmitted ? 'cursor-pointer' : 'opacity-75'}" data-task-id="${task.id}" ${!isSubmitted ? '' : 'style="pointer-events:none;"'}>
                        <div class="p-6">
                            <div class="flex items-start justify-between mb-3">
                                <span class="text-xs font-semibold px-2.5 py-1 rounded-full ${priorityColors[task.priority]}">${task.priority.toUpperCase()}</span>
                                <span class="text-xs font-semibold px-2.5 py-1 rounded-full ${statusColor}">${statusText}</span>
                            </div>
                            <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2 line-clamp-2">${task.title}</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-2">${task.description}</p>
                            <div class="flex items-center justify-between">
                                <span class="text-xs text-gray-500 dark:text-gray-500 font-medium">${task.category}</span>
                                ${!isSubmitted ? `<button class="text-primary hover:text-primary-dark font-semibold text-sm transition-colors">Annotate →</button>` : '<span class="text-sm text-gray-500">Completed</span>'}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            document.querySelectorAll('.task-card[data-task-id]').forEach(card => {
                if (card.style.pointerEvents !== 'none') {
                    card.addEventListener('click', () => {
                        const taskId = parseInt(card.dataset.taskId);
                        openTask(taskId);
                    });
                }
            });
        }

        function renderFeedbackList() {
            const feedbackList = document.getElementById('feedbackList');
            const annotations = dataStore.getAnnotations();
            const tasks = dataStore.getTasks();

            const userAnnotations = annotations.filter(a => a.annotator === (currentUser?.username) && a.feedback);

            if (userAnnotations.length === 0) {
                feedbackList.innerHTML = `
                    <div class="text-center py-12">
                        <svg class="w-16 h-16 mx-auto text-gray-400 dark:text-gray-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                        </svg>
                        <p class="text-gray-600 dark:text-gray-400 text-lg">No feedback yet</p>
                    </div>
                `;
                return;
            }

            feedbackList.innerHTML = userAnnotations.map(annotation => {
                const task = tasks.find(t => t.id === annotation.taskId);
                const feedbackStatus = annotation.feedback.approved
                    ? '<span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-400 text-xs font-semibold rounded-full">Approved</span>'
                    : '<span class="px-2 py-1 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-400 text-xs font-semibold rounded-full">Needs Revision</span>';

                return `
                    <div class="bg-white dark:bg-gray-900 rounded-xl shadow-md border border-gray-200 dark:border-gray-800 p-6">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-1">${task ? task.title : 'Unknown Task'}</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Reviewed by: ${annotation.feedback.reviewer}</p>
                            </div>
                            ${feedbackStatus}
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700">
                            <p class="text-sm font-semibold text-gray-900 dark:text-white mb-2">Feedback:</p>
                            <p class="text-gray-700 dark:text-gray-300 whitespace-pre-wrap">${annotation.feedback.comment}</p>
                        </div>
                        <div class="mt-3 text-xs text-gray-500">
                            Reviewed on ${new Date(annotation.feedback.timestamp).toLocaleString()}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateCompletedCount() {
            const annotations = dataStore.getAnnotations();
            const completedCount = annotations.filter(a => a.annotator === (currentUser?.username)).length;
            document.getElementById('completedCount').textContent = completedCount;
        }

        function openTask(taskId) {
            const tasks = dataStore.getTasks();
            currentTask = tasks.find(t => t.id === taskId);
            if (!currentTask) return;

            Object.keys(ratings).forEach(key => ratings[key] = null);
            document.querySelectorAll('.rating-button').forEach(btn => {
                btn.classList.remove('selected', 'bg-primary', 'text-white');
                btn.classList.add('bg-gray-100', 'dark:bg-gray-800');
            });
            document.getElementById('notes').value = '';

            document.getElementById('taskTitle').textContent = currentTask.title;
            document.getElementById('taskDescription').textContent = currentTask.description;
            document.getElementById('promptContent').textContent = currentTask.prompt;
            document.getElementById('responseContent').textContent = currentTask.response;

            document.getElementById('taskListView').classList.add('hidden');
            document.getElementById('annotationView').classList.remove('hidden');

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ===== REVIEWER DASHBOARD =====
        function renderReviewerDashboard() {
            renderSubmissionsList();
            renderManageTasksList();
            document.getElementById('completedCount').textContent = dataStore.getTasks().length;
        }

        function renderSubmissionsList() {
            const submissionsList = document.getElementById('submissionsList');
            const annotations = dataStore.getAnnotations();
            const tasks = dataStore.getTasks();

            const pendingAnnotations = annotations.filter(a => !a.feedback);

            if (pendingAnnotations.length === 0) {
                submissionsList.innerHTML = `
                    <div class="text-center py-12">
                        <svg class="w-16 h-16 mx-auto text-gray-400 dark:text-gray-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <p class="text-gray-600 dark:text-gray-400 text-lg">No pending submissions</p>
                    </div>
                `;
                return;
            }

            submissionsList.innerHTML = pendingAnnotations.map(annotation => {
                const task = tasks.find(t => t.id === annotation.taskId);
                if (!task) return '';

                return `
                    <div class="bg-white dark:bg-gray-900 rounded-xl shadow-md border border-gray-200 dark:border-gray-800 overflow-hidden">
                        <div class="p-6">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex-1">
                                    <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-1">${task.title}</h3>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Annotated by: ${annotation.annotator} • ${new Date(annotation.timestamp).toLocaleString()}</p>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 sm:grid-cols-5 gap-4 mb-4">
                                <div class="text-center"><div class="text-2xl font-bold text-primary">${annotation.ratings.accuracy}</div><div class="text-xs text-gray-600 dark:text-gray-400">Accuracy</div></div>
                                <div class="text-center"><div class="text-2xl font-bold text-primary">${annotation.ratings.relevance}</div><div class="text-xs text-gray-600 dark:text-gray-400">Relevance</div></div>
                                <div class="text-center"><div class="text-2xl font-bold text-primary">${annotation.ratings.safety}</div><div class="text-xs text-gray-600 dark:text-gray-400">Safety</div></div>
                                <div class="text-center"><div class="text-2xl font-bold text-primary">${annotation.ratings.helpfulness}</div><div class="text-xs text-gray-600 dark:text-gray-400">Helpfulness</div></div>
                                <div class="text-center"><div class="text-2xl font-bold text-primary">${annotation.ratings.completeness}</div><div class="text-xs text-gray-600 dark:text-gray-400">Completeness</div></div>
                            </div>

                            ${annotation.notes ? `
                                <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700 mb-4">
                                    <p class="text-sm font-semibold text-gray-900 dark:text-white mb-2">Annotator Notes:</p>
                                    <p class="text-gray-700 dark:text-gray-300 whitespace-pre-wrap">${annotation.notes}</p>
                                </div>
                            ` : ''}

                            <div class="border-t border-gray-200 dark:border-gray-800 pt-4">
                                <form class="feedback-form space-y-4" data-annotation-id="${annotation.id}">
                                    <div>
                                        <label class="block text-base font-semibold text-gray-900 dark:text-white mb-2">Feedback</label>
                                        <textarea class="feedback-comment w-full px-4 py-3 text-base bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent resize-none" rows="3" placeholder="Provide feedback to the annotator..." required></textarea>
                                    </div>
                                    <div class="flex gap-3">
                                        <button type="submit" data-approved="true" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors text-base">Approve</button>
                                        <button type="submit" data-approved="false" class="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors text-base">Request Revision</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            document.querySelectorAll('.feedback-form').forEach(form => {
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const annotationId = parseInt(form.dataset.annotationId);
                    const comment = form.querySelector('.feedback-comment').value;
                    const approved = e.submitter.dataset.approved === 'true';

                    const feedback = {
                        reviewer: currentUser.username,
                        comment,
                        approved,
                        timestamp: new Date().toISOString()
                    };

                    dataStore.updateAnnotation(annotationId, { feedback });
                    showSuccessModal('Feedback Submitted', 'Your feedback has been sent to the annotator.');
                    renderSubmissionsList();
                });
            });
        }

        function renderManageTasksList() {
            const manageTasksList = document.getElementById('manageTasksList');
            const tasks = dataStore.getTasks();
            const annotations = dataStore.getAnnotations();

            if (tasks.length === 0) {
                manageTasksList.innerHTML = `
                    <div class="text-center py-12">
                        <svg class="w-16 h-16 mx-auto text-gray-400 dark:text-gray-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <p class="text-gray-600 dark:text-gray-400 text-lg">No tasks available</p>
                    </div>
                `;
                return;
            }

            manageTasksList.innerHTML = tasks.map(task => {
                const taskAnnotations = annotations.filter(a => a.taskId === task.id);
                const priorityColors = {
                    high: 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400',
                    medium: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400',
                    low: 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400'
                };

                return `
                    <div class="bg-white dark:bg-gray-900 rounded-xl shadow-md border border-gray-200 dark:border-gray-800 p-6">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-2">
                                    <h3 class="text-lg font-bold text-gray-900 dark:text-white">${task.title}</h3>
                                    <span class="text-xs font-semibold px-2.5 py-1 rounded-full ${priorityColors[task.priority]}">${task.priority.toUpperCase()}</span>
                                </div>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">${task.description}</p>
                                <p class="text-xs text-gray-500">Category: ${task.category} • Created: ${new Date(task.createdAt).toLocaleDateString()}</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-800">
                            <div class="text-sm text-gray-600 dark:text-gray-400">
                                <span class="font-semibold text-primary">${taskAnnotations.length}</span> annotation${taskAnnotations.length !== 1 ? 's' : ''}
                            </div>
                            <button class="delete-task-btn px-4 py-2 text-base bg-red-100 dark:bg-red-900/30 hover:bg-red-200 dark:hover:bg-red-900/50 text-red-800 dark:text-red-400 font-semibold rounded-lg transition-colors" data-task-id="${task.id}">
                                Delete
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            document.querySelectorAll('.delete-task-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const taskId = parseInt(btn.dataset.taskId);
                    showConfirmDialog('Are you sure you want to delete this task?', () => {
                        dataStore.deleteTask(taskId);
                        renderManageTasksList();
                        showSuccessModal('Task Deleted', 'The task has been removed successfully.');
                    });
                });
            });
        }

        // ===== EVENT LISTENERS =====
        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.addEventListener('click', () => {
                const tab = btn.dataset.tab;
                document.querySelectorAll('.tab-button').forEach(b => {
                    b.classList.remove('tab-active');
                    b.classList.add('text-gray-600', 'dark:text-gray-400');
                });
                btn.classList.add('tab-active');
                btn.classList.remove('text-gray-600', 'dark:text-gray-400');

                if (tab === 'available') {
                    document.getElementById('availableTasksTab').classList.remove('hidden');
                    document.getElementById('feedbackTab').classList.add('hidden');
                } else {
                    document.getElementById('availableTasksTab').classList.add('hidden');
                    document.getElementById('feedbackTab').classList.remove('hidden');
                }
            });
        });

        document.querySelectorAll('.reviewer-tab').forEach(btn => {
            btn.addEventListener('click', () => {
                const tab = btn.dataset.tab;
                document.querySelectorAll('.reviewer-tab').forEach(b => {
                    b.classList.remove('tab-active');
                    b.classList.add('text-gray-600', 'dark:text-gray-400');
                });
                btn.classList.add('tab-active');
                btn.classList.remove('text-gray-600', 'dark:text-gray-400');

                document.querySelectorAll('.reviewer-tab-content').forEach(content => {
                    content.classList.add('hidden');
                });

                if (tab === 'submissions') {
                    document.getElementById('submissionsTab').classList.remove('hidden');
                } else if (tab === 'create') {
                    document.getElementById('createTaskTab').classList.remove('hidden');
                } else if (tab === 'manage') {
                    document.getElementById('manageTasksTab').classList.remove('hidden');
                }
            });
        });

        document.getElementById('backButton').addEventListener('click', () => {
            document.getElementById('annotationView').classList.add('hidden');
            document.getElementById('taskListView').classList.remove('hidden');
            currentTask = null;
        });

        document.querySelectorAll('.rating-button').forEach(button => {
            button.addEventListener('click', (e) => {
                e.preventDefault();
                const ratingType = button.dataset.rating;
                const value = parseInt(button.dataset.value);

                ratings[ratingType] = value;

                document.querySelectorAll(`[data-rating="${ratingType}"]`).forEach(btn => {
                    btn.classList.remove('selected', 'bg-primary', 'text-white');
                    btn.classList.add('bg-gray-100', 'dark:bg-gray-800');
                });
                button.classList.add('selected', 'bg-primary', 'text-white');
                button.classList.remove('bg-gray-100', 'dark:bg-gray-800');
            });
        });

        document.getElementById('annotationForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const missingRatings = Object.entries(ratings).filter(([_, value]) => value === null);
            if (missingRatings.length > 0) {
                showCustomAlert('Please provide ratings for all criteria before submitting.');
                return;
            }

            const notes = document.getElementById('notes').value;

            const annotation = {
                id: Date.now(),
                taskId: currentTask.id,
                annotator: currentUser.username,
                ratings: { ...ratings },
                notes,
                timestamp: new Date().toISOString()
            };

            dataStore.addAnnotation(annotation);
            showSuccessModal('Annotation Submitted!', 'Your feedback has been recorded successfully.');
            renderTaskCards();
            updateCompletedCount();
        });

        document.getElementById('skipButton').addEventListener('click', () => {
            document.getElementById('annotationView').classList.add('hidden');
            document.getElementById('taskListView').classList.remove('hidden');
            currentTask = null;
        });

        if (document.getElementById('filterStatus')) {
            document.getElementById('filterStatus').addEventListener('change', renderTaskCards);
        }

        document.getElementById('createTaskForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const task = {
                id: Date.now(),
                title: document.getElementById('taskTitleInput').value,
                description: document.getElementById('taskDescriptionInput').value,
                prompt: document.getElementById('taskPromptInput').value,
                response: document.getElementById('taskResponseInput').value,
                category: document.getElementById('taskCategoryInput').value,
                priority: document.getElementById('taskPriorityInput').value,
                status: 'pending',
                createdBy: currentUser.username,
                createdAt: new Date().toISOString()
            };

            dataStore.addTask(task);
            document.getElementById('createTaskForm').reset();
            showSuccessModal('Task Created!', 'The new annotation task has been added successfully.');
            renderManageTasksList();
        });

        document.getElementById('closeModal').addEventListener('click', () => {
            document.getElementById('successModal').classList.add('hidden');
            if (currentUser && currentUser.role === 'annotator' && document.getElementById('annotationView').classList.contains('hidden') === false) {
                document.getElementById('annotationView').classList.add('hidden');
                document.getElementById('taskListView').classList.remove('hidden');
            }
        });

        // ===== UTILITY FUNCTIONS =====
        function showSuccessModal(title, message) {
            document.getElementById('successTitle').textContent = title;
            document.getElementById('successMessage').textContent = message;
            document.getElementById('successModal').classList.remove('hidden');
        }

        function showCustomAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-2xl max-w-sm w-full mx-4 fade-in">
                    <div class="flex items-start mb-4">
                        <svg class="w-6 h-6 text-yellow-500 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                        <p class="text-gray-700 dark:text-gray-300">${message}</p>
                    </div>
                    <button class="w-full px-4 py-2 bg-primary text-white hover:bg-primary-dark rounded-lg transition-colors font-semibold text-base" onclick="this.closest('.fixed').remove()">OK</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-2xl max-w-sm w-full mx-4 fade-in">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end space-x-3">
                        <button class="cancel-btn px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-base">Cancel</button>
                        <button class="confirm-btn px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded text-base">Confirm</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            modal.querySelector('.cancel-btn').addEventListener('click', () => {
                modal.remove();
            });

            modal.querySelector('.confirm-btn').addEventListener('click', () => {
                modal.remove();
                onConfirm();
            });
        }
    </script>
</body>
</html>
